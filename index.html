<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Eros（愛欲之神）資源站</title>
  <style>
    body { margin:0; font-family:"Microsoft YaHei",Arial,sans-serif; background:#f9f9f9; }
    header { background:#f36; color:#fff; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { font-size:22px; margin:0; }
    header .search { display:flex; gap:5px; }
    header input { padding:6px; border:none; border-radius:3px; }
    header button { padding:6px 12px; border:none; background:#fff; color:#f36; border-radius:3px; cursor:pointer; }
    nav { background:#ff6699; display:flex; flex-wrap:wrap; padding:10px 20px; gap:15px; }
    nav a { color:#fff; font-weight:bold; }
    .categories { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:10px; padding:15px 20px; background:#fff; border-bottom:2px solid #eee; }
    .categories button { padding:8px; border:none; background:#ffe6f0; border-radius:5px; cursor:pointer; transition:0.3s; font-size:14px; }
    .categories button.active { background:#f36; color:#fff; font-weight:bold; }
    .movies { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:15px; padding:20px; }
    .movie-card { background:#fff; border:1px solid #eee; border-radius:8px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.05); transition:0.3s; }
    .movie-card:hover { transform:translateY(-3px); box-shadow:0 4px 10px rgba(0,0,0,0.1); }
    .movie-card img { width:100%; height:280px; object-fit:cover; }
    .movie-info { padding:10px; font-size:14px; }
    .movie-info h3 { margin:0 0 6px; font-size:16px; color:#333; }
    .meta { display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; font-size:12px; color:#555; }
    .tag { padding:2px 6px; border:1px solid #f3a; border-radius:999px; }
    .movie-info a { display:inline-block; margin-top:10px; padding:6px 10px; background:#f36; color:#fff; border-radius:4px; font-size:13px; text-decoration:none; }
    .movie-info a:hover { background:#d02450; }
    .pagination { display:flex; justify-content:center; gap:8px; margin:20px; flex-wrap:wrap; }
    .pagination button { padding:6px 12px; border:1px solid #ddd; border-radius:4px; background:#fff; color:#f36; cursor:pointer; }
    .pagination button.active { background:#f36; color:#fff; font-weight:bold; }
    .pagination button:disabled { color:#aaa; cursor:not-allowed; }
    footer { text-align:center; padding:15px; font-size:13px; color:#666; background:#fefefe; margin-top:20px; border-top:1px solid #eee; }
  </style>
</head>
<body>
  <header>
    <h1>Eros（愛欲之神）資源站</h1>
    <div class="search">
      <input type="text" id="searchInput" placeholder="請輸入影片名稱..." />
      <button onclick="searchMovies()">搜索</button>
    </div>
  </header>

  <nav>
    <a href="index.html">首頁</a>
    <a href="guanyu.html">關於我們</a>
    <a href="lianxi.html">聯繫我們</a>
    <a href="tutorial.html">下載教程</a>
  </nav>

  <section class="categories" id="categoryButtons">
    <button class="active" onclick="filterCategory('全部', this)">全部</button>
    <button onclick="filterCategory('歐美資源', this)">歐美資源</button>
    <button onclick="filterCategory('中文資源', this)">中文資源</button>
    <button onclick="filterCategory('日本資源', this)">日本資源</button>
    <button onclick="filterCategory('韓國資源', this)">韓國資源</button>
  </section>

  <section class="movies" id="movieList"></section>
  <div class="pagination" id="pagination"></div>

  <footer>© 2025 Eros（愛欲之神）資源站 - 優質資源網 | Eros（愛欲之神） 部署</footer>

  <script>
    let moviesData = [];
    let currentCategory = "全部";
    let currentPage = 1;
    const itemsPerPage = 20;

    async function loadMovies() {
      const res = await fetch("movies.json");
      const data = await res.json();

      // ✅ 按日期降冪排序（最新在前）
      moviesData = data.sort((a, b) => {
        // 確保日期統一為 YYYY-MM-DD；無效值排後
        const da = Date.parse(a.date || "");
        const db = Date.parse(b.date || "");
        if (isNaN(da) && isNaN(db)) return 0;
        if (isNaN(da)) return 1;
        if (isNaN(db)) return -1;
        return db - da;
      });

      renderMovies();
    }

    function getFilteredMovies() {
      const q = document.getElementById("searchInput").value.trim().toLowerCase();
      return moviesData.filter(m => {
        const byCategory = (currentCategory === "全部" || m.category === currentCategory);
        const bySearch =
          (m.title || "").toLowerCase().includes(q) ||
          (m.resolution || "").toLowerCase().includes(q); // 可按解析度搜：如 4k、1080p
        return byCategory && bySearch;
      });
    }

    function renderMovies() {
      const list = document.getElementById("movieList");
      list.innerHTML = "";

      const filtered = getFilteredMovies();
      const totalPages = Math.ceil(filtered.length / itemsPerPage) || 1;
      if (currentPage > totalPages) currentPage = totalPages;

      const start = (currentPage - 1) * itemsPerPage;
      const pageItems = filtered.slice(start, start + itemsPerPage);

      pageItems.forEach(m => {
  const size = (typeof m.size_gb === "number") ? m.size_gb.toFixed(1) + " GB" : (m.size_gb || "");
  const reso = m.resolution || "";
  const date = m.date || "";
  const duration = (typeof m.duration === "number") ? m.duration + " 分鐘" : (m.duration || "");
  const img = m.image || "";
  const title = m.title || "未命名";
  const link = m.link || "#";

  list.insertAdjacentHTML("beforeend", `
    <div class="movie-card">
      <img src="${img}" alt="${title}" loading="lazy" />
      <div class="movie-info">
        <h3 title="${title}">${title}</h3>
        <div class="meta">
          <span class="tag">${m.category || "未分類"}</span>
          ${reso ? `<span class="tag">${reso}</span>` : ""}
          ${size ? `<span class="tag">${size}</span>` : ""}
          ${duration ? `<span class="tag">${duration}</span>` : ""}
          ${date ? `<span class="tag">${date}</span>` : ""}
        </div>
        <a href="${link}" target="_blank" rel="nofollow noopener">購買下載地址</a>
      </div>
    </div>
  `);
});


      if (pageItems.length === 0) {
        list.innerHTML = "<p style='grid-column:1/-1;text-align:center;color:#999;'>沒有找到相關影片</p>";
      }

      renderPagination(totalPages);
    }

    function renderPagination(totalPages) {
      const p = document.getElementById("pagination");
      p.innerHTML = "";
      if (totalPages <= 1) return;

      const addBtn = (label, disabled, go) => {
        const b = document.createElement("button");
        b.textContent = label;
        b.disabled = disabled;
        if (!disabled) b.onclick = go;
        p.appendChild(b);
      };

      addBtn("« 上一頁", currentPage === 1, () => { currentPage--; renderMovies(); });

      // 簡潔頁碼：最多顯示 7 個（含當前）
      const max = 7;
      let start = Math.max(1, currentPage - Math.floor(max / 2));
      let end = Math.min(totalPages, start + max - 1);
      if (end - start + 1 < max) start = Math.max(1, end - max + 1);

      for (let i = start; i <= end; i++) {
        const b = document.createElement("button");
        b.textContent = i;
        if (i === currentPage) b.classList.add("active");
        b.onclick = () => { currentPage = i; renderMovies(); };
        p.appendChild(b);
      }

      addBtn("下一頁 »", currentPage === totalPages, () => { currentPage++; renderMovies(); });
    }

    function filterCategory(cat, btn) {
      currentCategory = cat;
      currentPage = 1;
      document.querySelectorAll("#categoryButtons button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderMovies();
    }

    function searchMovies() {
      currentPage = 1;
      renderMovies();
    }

    loadMovies();
  </script>
</body>
</html>
